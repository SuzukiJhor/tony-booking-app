generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum StatusAgendamento {
  PENDENTE
  MENSAGEM_ENVIADA
  CONFIRMADO
  NAO_CONFIRMADO
  CANCELADO
}

enum TipoAgendamento {
  CONSULTA
  RETORNO
  EXAME
}

// -----------------------------------------------------
// üè¢ Modelo Empresa (Tenant)
// -----------------------------------------------------
model Empresa {
  id               Int            @id @default(autoincrement())
  nome             String
  slug             String         @unique
  planoAtivo       String         @default("FREE")
  
  endereco      Endereco?

  // Relacionamentos Inversos (back-relations)
  pacientes        Paciente[]
  profissionais    Profissional[]
  agendamentos     Agendamento[]
  configuracoes    Configuracao[] 
  acessos          AcessoSistema[]

  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

// -----------------------------------------------------
// üë§ Modelo Paciente - Isolado por Empresa
// -----------------------------------------------------
model Paciente {
  id             Int             @id @default(autoincrement())
  nome           String
  telefone       String
  email          String?
  
  // Chave de Isolamento (Tenant ID)
  empresaId      Int
  empresa        Empresa         @relation(fields: [empresaId], references: [id])
  
  agendamentos   Agendamento[]

  isDeleted Boolean  @default(false)

  @@unique([telefone, empresaId]) 
  @@unique([email, empresaId])
}

model Profissional {
  id            Int      @id @default(autoincrement())
  nome          String
  documento     String?  // Pode ser CRO, CRM, CPF, etc.
  especialidade String?
  telefone       String?
  ativo         Boolean  @default(true)

  // Chave de Isolamento (Tenant ID)
  empresaId     Int
  empresa       Empresa  @relation(fields: [empresaId], references: [id])

  agendamentos  Agendamento[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([documento, empresaId])
}

// -----------------------------------------------------
// üìÖ Modelo Agendamento - Isolado por Empresa
// -----------------------------------------------------
model Agendamento {
  id                Int                  @id @default(autoincrement())
  dataHora          DateTime
  statusConfirmacao StatusAgendamento    @default(PENDENTE)

  mensagemEnviadaEm DateTime?
  mensagemId        String?
  
  pacienteId        Int
  paciente          Paciente             @relation(fields: [pacienteId], references: [id])

  profissionalId    Int?
  profissional      Profissional?      @relation(fields: [profissionalId], references: [id])
  
  empresaId         Int
  empresa           Empresa              @relation(fields: [empresaId], references: [id])

  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  tipoAgendamento   TipoAgendamento      @default(CONSULTA)
  tempoAtendimento  Int                  @default(60)

  isDeleted         Boolean           @default(false)
}

model Endereco {
  id          Int      @id @default(autoincrement())
  logradouro  String
  numero      String
  complemento String?
  bairro      String?
  cidade      String
  estado      String?
  cep         String?

  empresaId   Int      @unique
  empresa     Empresa  @relation(fields: [empresaId], references: [id], onDelete: Cascade)
}

// -----------------------------------------------------
// ‚öôÔ∏è Modelo Configura√ß√£o - Isolado por Empresa
// -----------------------------------------------------
model Configuracao {
  id        Int         @id @default(autoincrement())
  chave     String
  valor     String?
  telefone  String?

  empresaId Int
  empresa   Empresa @relation(fields: [empresaId], references: [id])

  @@unique([chave, empresaId]) 
}

model AcessoSistema {
  id            Int     @id @default(autoincrement())
  email         String  @unique 
  password      String
  empresaId     Int?
  empresa       Empresa?   @relation(fields: [empresaId], references: [id])
  @@map("acesso_sistema")
}